# ikakbolit - Medication Scheduling App üè•

![Build Status](https://img.shields.io/badge/build-passing-brightgreen)
![Go Version](https://img.shields.io/badge/Go-1.23.3-blue)
![Docker](https://img.shields.io/badge/Docker-Supported-blue)

**ikakbolit** ‚Äî —ç—Ç–æ –±—ç–∫–µ–Ω–¥-—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏—ë–º–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–∏—ë–º–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –±–ª–∏–∂–∞–π—à–∏–µ –ø—Ä–∏—ë–º—ã –∏ –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤–∞—Ö. –í –∫–∞—á–µ—Å—Ç–≤–µ –ë–î –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **[PostgreSQL](https://www.postgresql.org)**


## üöÄ –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

**–û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**
- **[gorilla/mux](https://github.com/gorilla/mux)** ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –¥–ª—è —É–¥–æ–±–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å REST API.
- **[pgx](https://github.com/jackc/pgx)** ‚Äî –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è PostgreSQL, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
- **[godotenv](https://github.com/joho/godotenv)** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ `.env`.
- **[swaggo/swag](https://github.com/swaggo/swag)** + **[http-swagger](https://github.com/swaggo/http-swagger)** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ OpenAPI-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- **[goose](https://github.com/pressly/goose)** ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- **[Docker](https://www.docker.com/)** ‚Äî —É–ø–∞–∫–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–ü—Ä–æ–µ–∫—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Ç—Ä—ë—Ö—Å–ª–æ–π–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.
### 1. Presentation Layer (Controller)
### 2. Business Logic Layer (Service)
### 3. Data Access Layer (Repo)

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
1. **HTTP-–∑–∞–ø—Ä–æ—Å** ‚Üí Controller (–≤–∞–ª–∏–¥–∞—Ü–∏—è) ‚Üí Service (–ª–æ–≥–∏–∫–∞) ‚Üí Repo (–ë–î)
2. **–û—Ç–≤–µ—Ç**: Repo ‚Üí Service ‚Üí Controller ‚Üí HTTP-–∫–ª–∏–µ–Ω—Ç

### –ü—Ä–∏–Ω—Ü–∏–ø—ã:
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –ö–∞–∂–¥—ã–π —Å–ª–æ–π —Ä–µ—à–∞–µ—Ç —Å–≤–æ—é –∑–∞–¥–∞—á—É.
- **–ò–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –°–ª–æ–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (–Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏).

## üì• –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```sh
git clone --depth=1 https://github.com/infinity-ocean/ikakbolit.git
cd ikakbolit
```

### 2Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π `.env` —Ñ–∞–π–ª –∏ —É–∫–∞–∂–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```ini
POSTGRES_HOST=localhost       # –•–æ—Å—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
POSTGRES_PORT=5432            # –ü–æ—Ä—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
POSTGRES_USER=postgres        # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î
POSTGRES_PASSWORD=12345       # –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î
POSTGRES_DB=postgres          # –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
POSTGRES_SSL=disable          # –û—Ç–∫–ª—é—á–µ–Ω–∏–µ SSL (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

DAY_START=08:00               # –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –¥–Ω—è (–ß–ß:–ú–ú, 24-—á–∞—Å–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç)
DAY_FINISH=21:45              # –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–Ω—è
CURE_SCHEDULE_WINDOW_MIN=180  # –ü–µ—Ä–∏–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π (–≤ –º–∏–Ω—É—Ç–∞—Ö)
```

### 3Ô∏è‚É£ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```sh
go mod tidy
make install-deps
```

### 4Ô∏è‚É£ –ó–∞–ø—É—Å–∫ PostgreSQL –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
```sh
make start-infra
```

### 5Ô∏è‚É£ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```sh
make migration-up
```

### 6Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ (–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å .env —Ñ–∞–π–ª–æ–º)
```sh
go run internal/cmd/main.go
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8080

Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API: http://localhost:8080/swagger/index.html

## –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
- **1Ô∏è‚É£ POST /schedule**: –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–µ–º–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û–∂–∏–¥–∞–µ—Ç JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ø—Ä–∏–µ–º–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
–û–∂–∏–¥–∞–µ–º—ã–π JSON –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞:
```json
{
  "user_id": 1,
  "cure_name": "Arbidol",
  "doses_per_day": 7,
  "duration_days": 5 // –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è 0, –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø—Ä–∏—ë–º –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞
}
```
–ü–æ–ª–µ ```"duration_days"``` –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏—ë–º–∞, —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –¥–Ω—è—Ö, ```"doses_per_day"``` –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –ø—Ä–∏—ë–º–æ–≤.
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "schedule_id": 42,
}
```
- **2Ô∏è‚É£ GET /schedules?user_id=**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ ID —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä user_id –≤ query.
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "schedules": [1, 2, 3]
}
```
- **3Ô∏è‚É£ GET /schedule?user_id=&schedule_id=**: –ü–æ–ª—É—á–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏–µ–º–∞ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞ –ø–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ ID —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è. –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã user_id –∏ schedule_id –≤ query. –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
    "ID": 4,
    "UserID": 4,
    "CureName": "Amoxicillin",
    "DosesPerDay": 3,
    "DurationDays": 12,
    "CreatedAt": "2025-03-12T17:48:42.645442Z",
    "Intakes": [
        "08:00",
        "14:52",
        "21:45"
    ]
}
```
- **4Ô∏è‚É£ GET /next_takings?user_id**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –±–ª–∏–∂–∞–π—à–∏—Ö –ø—Ä–∏–µ–º–æ–≤ –ª–µ–∫–∞—Ä—Å—Ç–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–µ—Ä–∏–æ–¥, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º—ã–π –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π ```"CURE_SCHEDULE_WINDOW_MIN"```. –¢—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä user_id –≤ query.
–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "schedules": [
    {
      "ID": 8,
      "user_id": "8",
      "cure_name": "Atorvastatin",
      "doses_per_day": 2,
      "duration_days": 3,
      "created_at": "2025-03-07T23:46:58.292596Z",
      "intakes": [
        "08:00",
        "21:44"
      ]
    }
  ]
}
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è OpenAPI-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑ –ø–∞–∫–µ—Ç–∞ **internal**
```sh
cd internal
swag init -g cmd/main.go
```

### üõ† –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (Makefile)

| –ö–æ–º–∞–Ω–¥–∞              | –û–ø–∏—Å–∞–Ω–∏–µ                                         |
|----------------------|--------------------------------------------------|
| `make install-deps`  | –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏                        |
| `make start-infra`   | –ó–∞–ø—É—Å–∫–∞–µ—Ç PostgreSQL –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ                |
| `make stop-infra`    | –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL               |
| `make migration-up`  | –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö                   |
| `make migration-down`| –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏                              |

### üõ† –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
* [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (JWT / OAuth) 
* [ ] –£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤